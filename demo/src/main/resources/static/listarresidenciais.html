<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>Lista de Residenciais</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1b1b1b;
            color: #f0f0f0;
        }

        .list-group-item {
            background-color: #2a2a2a;
            border: none;
            color: #f0f0f0;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .btn-outline-light:hover {
            background-color: #b30000;
            border-color: #b30000;
            color: white;
        }

        .btn-warning {
            background-color: #ffc107 !important;
            border: none;
            color: #000;
        }

        .btn-danger {
            background-color: #dc3545 !important;
            border: none;
        }

        .btn-dark {
            background-color: #b30000 !important;
            border: none;
        }

        .btn-dark:hover {
            background-color: #ff1a1a !important;
        }

        nav {
            background-color: transparent !important;
        }
    </style>
</head>
<body>

<nav class="px-4 mt-2 d-flex gap-2">
</nav>

<div class="container mt-4">
    <h2>Lista de Residenciais</h2>
    <ul id="listaResidenciais" class="list-group mt-3"></ul>
</div>

<script>
    async function carregarResidenciais() {
        const response = await fetch("/residenciais");
        const residenciais = await response.json();
        const lista = document.getElementById("listaResidenciais");
        lista.innerHTML = "";

        residenciais.forEach(r => {
            const li = document.createElement("li");
            li.className = "list-group-item d-flex justify-content-between align-items-center";
            li.innerHTML = `
        ${r.nomeResidencial ?? "Sem nome"} (${r.cnpj}) - ${r.estado ?? ""}
        <div>
          <button class="btn btn-sm btn-warning me-1" onclick='editarResidencial(${JSON.stringify(r)})'>Editar</button>
          <button class="btn btn-sm btn-danger" onclick="deletarResidencial('${r.cnpj}')">Deletar</button>
        </div>
      `;
            lista.appendChild(li);
        });
    }

    function editarResidencial(r) {
        const params = new URLSearchParams(r).toString();
        window.location.href = `cadastroresidencial.html?${params}`;
    }

    async function deletarResidencial(cnpj) {
        if (confirm("Deseja realmente deletar este residencial?")) {
            const response = await fetch(`/residenciais?cnpj=${encodeURIComponent(cnpj)}`, {
                method: "DELETE"
            });
            if (response.ok) {
                carregarResidenciais();
            } else {
                alert("Erro ao deletar residencial.");
            }
        }
    }

    window.onload = carregarResidenciais;
</script>

</body>
</html>
